<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
    <!-- Basic Page Needs -->
    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title"       content="Perl Weekly Challenge - Perl & Raku"/>
    <meta property="og:type"        content="website"/>
    <meta property="og:url"         content="https://perlweeklychallenge.org/"/>
    <meta property="og:image"       content="https://perlweeklychallenge.org/images/about/about.jpg"/>
    <meta property="og:description" content="You do not have to be an expert."/>
    <meta name="twitter:card"       content="summary" />
    <meta name="twitter:image"      content="https://perlweeklychallenge.org/images/about/about.jpg"/>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="description" content="Laurent Rosenfeld Weekly Review: Challenge - #004.">
    <meta name="author" content="Perl Weekly Challenge Team">
    <meta name="generator" content="Hugo 0.55.0-DEV" />

    <!-- Mobile Specific Metas -->
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Laurent Rosenfeld Weekly Review: Challenge - 004</title>
    <link rel="icon" href="https://perlweeklychallenge.org/images/favicon.ico">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>

    <!-- Twitter Bootstrs CSS -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.css">
    <!-- Ionicons Fonts Css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/ionicons/ionicons.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/animate-css/animate.css">
    <!-- Hero area slider css-->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slider/slider.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slick/slick.css">
    <!-- Fancybox -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.css">
    <!-- hover -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/hover/hover-min.css">
    <!-- template main css file -->
    
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/style.min.css" integrity="" media="screen">
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/main.css">
</head>

<body>

<section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="https://perlweeklychallenge.org/">
                        <img src="https://perlweeklychallenge.org/images/logo.svg" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navgation" aria-controls="navigation"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/">Home</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/about">About</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/chart">Chart</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/champions">Champions</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/team">Team</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/challenges">Challenges</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p5-reviews">Perl/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p6-reviews">Raku/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/recaps">Recaps</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/blogs">Blogs</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/faq">FAQ</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/contact">Contact</a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>


<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Laurent Rosenfeld Weekly Review: Challenge - 004</h2>
                    <div class="portfolio-meta">
                        <span>Sunday, Nov 10, 2019</span>|
                        <span> Tags:
                            Raku
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div style="text-align: center" class="post-img">
                    <img class="img-fluid" alt="" src="https://perlweeklychallenge.org/images/blog/p6-review-challenge-004.jpg">
                </div>
                
                <div style="text-align: justify" class="post-content">
                    

<hr />

<h1 id="raku-solutions-weekly-review">Raku Solutions Weekly Review</h1>

<hr />

<h2 id="task-1-computing-the-digits-of-pi">Task #1: Computing the Digits of Pi</h2>

<p>This is derived in part from my <a href="http://blogs.perl.org/users/laurent_r/2019/04/perl-weekly-challenge-week-4.html">blog post</a> made in answer to the <a href="https://perlweeklychallenge.org/blog/perl-weekly-challenge-004/">Week 04 of the Perl Weekly Challenge</a> organized by  <a href="http://blogs.perl.org/users/mohammad_s_anwar/">Mohammad S. Anwar</a> as well as answers made by others to the same challenge.</p>

<p>The challenge reads as follows:</p>

<p><em>Write a script to output the same number of PI digits as the size of your script. Say, if your script size is 10, it should print 3.141592653.</em></p>

<h2 id="my-solutions">My Solutions</h2>

<p>Let&rsquo;s start with a simple one-liner satisfying the requirement:</p>

<pre><code>perl6 -e '
print pi, &quot;\n&quot;;
'
3.14159265358979
</code></pre>

<p>So, job done? Well, yes and no. Let&rsquo;s try to be more serious and adapt the size of our output to the size of the script, which means to actually calculate some digits of pi.</p>

<p>I&rsquo;ve tried several formulae known for centuries (François Viète, John Wallis, John Machin, Isaac Newton, Gottfried Wilhelm Leibniz, etc.), but will show only one of them to illustrate the problem.</p>

<p><a href="https://en.wikipedia.org/wiki/Pi#Infinite_series">John Wallis&rsquo;s infinite product</a> can be reformatted as:</p>

<pre><code>pi / 2 = (2 * 2 * 4 * 4 * 6 * 6 * 8 * 8 ... ) / (1 * 3 * 3 * 5 * 5 * 7 * 7 * 9 ...)
</code></pre>

<p>We can build two lazy infinite lists, one for the numerator and one for the denominator and use the reduction operator to calculate Wallis&rsquo;s infinite product:</p>

<pre><code class="language-Perl6">my @numerators =  2, 2, -&gt; $a, $b {| ($a + 2, $b + 2) } ... *;
my @denominators = 1, 3, 3, -&gt; $a, $b {| ($a + 2, $b + 2) } ... *;
my $pi = 2 * ([*] @numerators[0..2000]) / ([*] @denominators[0..2000]);
</code></pre>

<p>The value obtained for <code>$pi</code> is:</p>

<pre><code>3.14237736509388
</code></pre>

<p>Only the first three digits are correct with a product of two thousands terms! Quite obviously, those century-old formulas converge much too slowly for our purpose. We need something more efficient.</p>

<p>The Indian mathematician Srinivasa Ramanujan is known as the author of a number of innovative new formulae for calculating digits of pi during the first decades of the twentieth century, but the one I looked at is not so easy to implement, notably because it involves the square root of two, so we would need to start by calculating the digits of that number as a <code>FatRat</code>. This is the solution adopted by Doug Schrag (see below in the <em>Alternative Solutions</em> section), but I decided to take another approach.</p>

<p>In 2006, Franco-Canadian mathematician Simon Plouffe used the so-called PSLQ integer relation algorithm to generate several new formulae for pi. One of them was described back in 1995 and is known as <a href="https://en.wikipedia.org/wiki/Pi#Spigot_algorithms">one of the spigot algorithms</a>.</p>

<p>We can write the following <code>plouffe</code> subroutine:</p>

<pre><code class="language-Perl6">sub plouffe (Int $k) {
    my $result = (1 / 16 ** $k) * (  (4 / (8 * $k + 1)) - (2 / (8 * $k + 4)) - (1 / (8 * $k + 5)) - (1 / (8 * $k + 6) )  );
}
</code></pre>

<p>to calculate the individual terms of the infinite sum and then compute pi as follows:</p>

<pre><code class="language-Perl6">my $pi = [\+]  (plouffe $_ for 0..20);
</code></pre>

<p>That does not work properly, however, as the <code>plouffe</code> terms get converted from rationals to floats (well, really from <code>Rat</code> to <code>Num</code>) when the input value reaches 11 or more, as shown here under the REPL:</p>

<pre><code>&gt; say (plouffe $_).WHAT for 0..15;
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Rat)
(Num)
(Num)
(Num)
(Num)
(Num)
</code></pre>

<p>so that we are losing accuracy and the result:</p>

<pre><code>3.141592653589793129614170564041344859
</code></pre>

<p>is correct only up to the 16th digit.</p>

<p>So, let&rsquo;s try to use the <code>FatRat</code> type:</p>

<pre><code class="language-Perl6">sub plouffe (Int $k) {
    my $result = 1.FatRat *  (1 / 16 ** $k) * (  (4 / (8 * $k + 1)) - (2 / (8 * $k + 4)) - (1 / (8 * $k + 5)) - (1 / (8 * $k + 6) )  );
}
</code></pre>

<p>It is a bit better, but we are again falling back to <code>Num</code> when the subroutine input value reaches 17 or above:</p>

<pre><code>&gt; say (plouffe $_).WHAT for 0..20;
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(FatRat)
(Num)
(Num)
(Num)
(Num)
(Num)
</code></pre>

<p>For some reason, coercing the input value to a <code>FatRat</code>:</p>

<pre><code class="language-Perl6">sub plouffe (FatRat $k) {
    my $result =  (1 / 16 ** $k) * (  (4 / (8 * $k + 1)) - (2 / (8 * $k + 4)) - (1 / (8 * $k + 5)) - (1 / (8 * $k + 6) )  );
}
say (plouffe $_.FatRat).WHAT for 0..20;
</code></pre>

<p>doesn&rsquo;t work either.</p>

<p>While still trying to understand why we are falling from <code>FatRat</code> to <code>Num</code>, I posted a question on <a href="https://www.nntp.perl.org/group/perl.perl6.users/2019/04/msg6664.html">perl6-users</a>, and I quickly received very useful tips from Fernando Santagata and Brian Duggan. Many thanks to them.</p>

<p>The following syntax suggested by Brian works properly:</p>

<pre><code class="language-Perl6">sub plouffe (Int $k) {
    my $result = (1.FatRat / 16 ** $k) * (  (4 / (8 * $k + 1)) - (2 / (8 * $k + 4)) - (1 / (8 * $k + 5)) - (1 / (8 * $k + 6) )  );
}
# printing 200 digits of pi
my $pi = [+] (plouffe $_ for  0..200);
</code></pre>

<p>Now, <code>$pi</code> is populated with about 750 digits, two thirds of which are wrong, but the important point is that they are all correct up to the 249th digit. In general, we get an average of about 1.2 correct digits per term in the sum. So, with the above input values, we&rsquo;re on the safe side of things if we print out the first two hundred digits under the REPL:</p>

<pre><code>&gt; say substr $pi, 0, 201;
3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819
</code></pre>

<p>It is now fairly easy to output the same number of PI digits as the size of the script:</p>

<pre><code class="language-Perl6">sub plouffe (Int $k) {
    my $result = (1.FatRat / 16 ** $k) * (  (4 / (8 * $k + 1)) - (2 / (8 * $k + 4)) - (1 / (8 * $k + 5)) - (1 / (8 * $k + 6) )  );
}
my $script-size = $*PROGRAM-NAME.IO.s;
my $pi = [+] (plouffe $_ for  0..$script-size);
say substr $pi, 0, $script-size + 1; # +1 because the decimal dot isn't a digit
</code></pre>

<p>The script has 290 bytes and the script prints the first 290 digits of pi:</p>

<pre><code>$ perl6 pi.p6
3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072
</code></pre>

<p>The script runs in slightly less than 1.5 sec.</p>

<h2 id="alternative-solutions">Alternative Solutions</h2>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/arne-sommer/perl6/ch-1.p6">Arne Sommer</a> provided a solution very similar to my initial one-liner:</p>

<pre><code class="language-Perl6">say pi.fmt('%.19f')
</code></pre>

<p>He also suggested <a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/arne-sommer/perl6/say-pi-module">another solution</a> using the following <code>PiXL.pm6</code>module:</p>

<pre><code class="language-Perl6">use v6.d;

unit module PiXL;

our constant $PI is export = &quot;3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989&quot;;
</code></pre>

<p>and then used the module as follows:</p>

<pre><code class="language-Perl6">use lib &quot;lib&quot;;
use PiXL;

say $PI.substr(0, $?FILE.IO.s -1);
</code></pre>

<p>The trick is clear: store so many digits of pi as you want in a separate module, since the size of the module will not counted in the script size.</p>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/jo-christian-oterhals/perl6/ch-1.p6">Jo Christian Oterhals</a> used essentially the same trick and first  created the following <code>BigPi.pm6</code> module:</p>

<pre><code class="language-Perl6"># Perl 6 Module BigPI.pm6
# Place in script directory and use perl6 with -I flag
# i.e. perl6 -I. &lt;calling script&gt;

unit module BigPI;

# This definition of PI is taken from the Perl 5 module Math::BigFloat
constant PI = join '', qw:to/END/;
314159265358979323846264338327950288419716939937510582097494459230781640628
620899862803482534211706798214808651328230664709384460955058223172535940812
848111745028410270193852110555964462294895493038196442881097566593344612847
564823378678316527120190914564856692346034861045432664821339360726024914127
372458700660631558817488152092096282925409171536436789259036001133053054882
046652138414695194151160943305727036575959195309218611738193261179310511854
807446237996274956735188575272489122793818301194912983367336244065664308602
139494639522473719070217986094370277053921717629317675238467481846766940513
200056812714526356082778577134275778960917363717872146844090122495343014654
958537105079227968925892354201995611212902196086403441815981362977477130996
051870721134999999837297804995105973173281609631859502445945534690830264252
230825334468503526193118817101000313783875288658753320838142061717766914730
359825349042875546873115956286388235378759375195778185778053217122680661300
192787661119590921642019893809525720106548586327886593615338182796823030195
END
</code></pre>

<p>and then used it as follows:</p>

<pre><code class="language-Perl6">use BigPI;

say BigPI::pi $?FILE.IO.s;
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/joelle-maslak/perl6/ch-1.p6">Joelle Maslak</a> also hard-coded the digits of pi but had the clever idea of using a base-32 representation of pi, thus making the script shorter:</p>

<pre><code class="language-Perl6">say 3~'.'~:32&lt;35IPR975H1E3E2K2GQK0D32I3C1U7N&gt;
</code></pre>

<p>This works properly as shown under the REPL:</p>

<pre><code>&gt; say 3~'.'~:32&lt;35IPR975H1E3E2K2GQK0D32I3C1U7N&gt;
3.141592653589793238462643383279502884197169399
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/doug-schrag/perl6/ch-1.p6">Doug Schrag</a> based his calculation of a formula discovered by Srinivasa Ramanujan:</p>

<p><img src="/images/blog/Ramanujan_pi.png" alt="" /></p>

<p>For this, he first implemented a <code>sqrt-rat</code> subroutine to compute a <code>FatRat</code> estimate of the square root of 2:</p>

<pre><code class="language-Perl6">my $chars = $*PROGRAM.slurp.chars;
say pi-rat.Str.substr(0,$chars);
say &quot;$chars digits!&quot;;

sub postfix:&lt;!&gt; ($n) { [*] 1..$n }
sub f($k) {
    FatRat.new: (4*$k)! * (1103 + 26390 * $k), ($k!)**4 * 396**(4*$k)
}
sub pi-rat () {
    9801 * sqrt-rat(2, 1e-500) / 4
    / [+] (^80).map: *.&amp;f
}

multi sub sqrt-rat ($n where * &gt; 0, $eps) {
    my $base = $n.FatRat($eps);
    my $r = sqrt($base).FatRat($eps);
    my $est;
    repeat {
        $est = $r;
        $r = ($base / $est + $est) / 2;
    } while abs($r - $est) &gt; $eps;

    return $r;
}
multi sub sqrt-rat (0) { 0 }
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/fjwhittle/perl6/ch-1.p6">Francis J. Whittle</a> apparently based his computation on the Newton-Euler convergence transformation formula:</p>

<p><img src="/images/blog/Newton-Euler.png" alt="" /></p>

<p>where (2k + 1)!! denotes the product of the odd integers up to 2k + 1.</p>

<p>His program first computes a lazy list of the various terms of the sum and then multiplies by two the sum of the 608 first terms:</p>

<pre><code class="language-Perl6">my $eu-seq = gather {
  take 1;
  for 1..* -&gt; $n { take $eu-seq[$n - 1] * FatRat.new($n, 2 * $n + 1) }
}

my \π := 2 * [+] $eu-seq[^608];

put π.Str.substr: ^($?FILE.IO.s+1);
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/jaldhar-h-vyas/perl6/ch-1.p6">Jaldhar H. Vyas</a> provided a very simple solution using the <code>Rat::Precise</code> module:</p>

<pre><code class="language-Perl6"># Thanks to thundergnat for the module and informing me about it on IRC.
use Rat::Precise;

my $size =  $*PROGRAM-NAME.IO.s;
π.FatRat.precise($size - 1).say; # - 1 because 3. is a digit of pi
</code></pre>

<p>I also did not know about that module, so thanks to <em>thundergnat</em> and to Jaldhar for the information.</p>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/james-smith/perl6/ch-1.p6">James A. Smith</a> provided a solution similar to my initial one-liner:</p>

<pre><code class="language-Perl6">say 2*atan2 1,0;
</code></pre>

<p>Actually, this almost exactly the idea I suggested in my Perl 5 solution.</p>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/nick-logan/perl6/ch-1.p6">Nick Logan</a> submitted a polyglot script, i.e. a script running both in Perl 5 and Perl 6:</p>

<pre><code class="language-Perl6"># WARNING: this polyglot breaks best practices of both Perl 5 and Perl 6 in order to run on both

sub eval($_)      { &amp;EVAL($_) };
sub polyint($_)   { &quot;0&quot; and (return Int($_[0])) or (return int($_[0])) };
sub script_size   { &quot;0&quot; and (return 0+eval('$*PROGRAM.IO.s')) or (return 0+eval('-s $0')) };
#`() use isms; sub infix:«&lt;&lt;»($a,$b) { $a +&lt; $b };

my $digits = script_size() + 1;
my (@out, @a);
my ($b, $c, $d, $e, $f, $g, $i, $d4, $d3, $d2, $d1);

$b = $d = $e = $g = $i = 0;
$f = 10000;
$c = 14 * (polyint($digits/4)+2);
print &quot;3.&quot;;
while (($b = $c -= 14) &gt; 0 &amp;&amp; $i &lt; $digits) {
    $d = $e = $d % $f;
    while (--$b &gt; 0) {
        $d = $d * $b + (@a[$b] // 20000000);
        $g = ($b &lt;&lt; 1) - 1;
        @a[$b] = ($d % $g) * $f;
        $d = polyint($d / $g);
    }
    $d4 = $e + polyint($d/$f);
    if ($d4 &gt; 9999) {
        $d4 -= 10000;
        @out[$i-1]++;
        $b = $i-1;
        while (@out[$b] == 1) {
            @out[$b] = 0;
            @out[$b-1]++;
            $b--;
        }
    }
    $d3 = polyint($d4/10);
    $d2 = polyint($d3/10);
    $d1 = polyint($d2/10);
    @out[$i++] = $d1;
    @out[$i++] = $d2-$d1*10;
    @out[$i++] = $d3-$d2*10;
    @out[$i++] = $d4-$d3*10;
    print join &quot;&quot;, @out[$i-15 .. $i-15+3] if $i &gt;= 16;
}
print join &quot;&quot;, @out[$i-15+4 .. $digits-2], &quot;\n&quot;;
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/rob4t/perl6/ch-1.p6">Rob4t</a> used basically the same idea as in my initial one-liner:</p>

<pre><code class="language-Perl6">say π;#size 16
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/ruben-westerberg/perl6/ch-1.p6">Ruben Westerberg</a> used, if I understand well, one of the numerous continued fraction formulae:</p>

<pre><code class="language-Perl6">#!/usr/bin/env perl6
my $places= $*PROGRAM-NAME.IO.s + 1;
printf &quot;Places: $places\n&quot;;
my $prev=&quot;&quot;;
my $sign;
my $pi=(0/1).FatRat;
my $denom=1;
my $stable= 0;
my $i=0;
my $float;
until ($stable) {
    $sign= (($i %% 2) ?? 4  !! -4);
    $pi+=($sign/$denom).FatRat;
    $denom+=2;
    $i++;
    $float=$pi.Str.substr(0,$places+1);
    say &quot;Iteration: $i, Value of PI (to $places decimal places):$float&quot;;
    $stable=$float eq $prev;
    $prev=$float;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/mark-senn/perl6/ch-1.p6">Mark Senn</a> used the same formula by Simon Plouffe formula as I did:</p>

<pre><code class="language-Perl6">sub plouffe (Int $k)
{
    (1.FatRat/16**$k) *
    (
          (4 / (8*$k + 1))
        - (2 / (8*$k + 4))
        - (1 / (8*$k + 5))
        - (1 / (8*$k + 6))
    )
}

# Get size of the script.
my $size = $*PROGRAM-NAME.IO.s;

# The value of pi has only been double
# checked up to 1000 characters.
if ($size &gt; 1_000)
{
    die &quot;program not tested for a &quot;
        ~ &quot;script size of more than &quot;
        ~ &quot;1000 characters&quot;;
}

my $pi = [+] (plouffe $_ for 0..$size);

say substr($pi, 0, $size);
</code></pre>

<p>Mark acknowledges in his blog post that he was prompted to use this formula by my question on <a href="https://www.nntp.perl.org/group/perl.perl6.users/2019/04/msg6664.html">perl6-users</a> and the answers provided by Fernando Santagata and Brian Duggan.</p>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/simon-proctor/perl6/ch-1.p6">Simon Proctor</a> created a <code>///</code> operator to transform simple division into <code>FatRat</code> constructor and assignment, thus avoiding the <code>Rat</code> falling to <code>Num</code> problem I reported at the beginning of this post. Otherwise, he used the same Plouffe formula as I did:</p>

<pre><code class="language-Perl6">sub infix:&lt;///&gt; ( Int() $nu, Int() $de ) { FatRat.new( $nu, $de ) }

sub bbp-digit ( Int $k ) {
    my $k8 = $k*8;
    (1 /// (16 ** $k)) * ((4 /// ($k8 + 1)) - (2 /// ($k8 + 4)) - (1 /// ($k8 + 5)) - (1 /// ($k8+6)));
}

sub calc-pi( Int $num ) {
    my $p = [+] ( 0..$num ).map( &amp;bbp-digit );
    return $p.Str.substr(0,$num+1);
}

#| Calculate PI to a given number of digits
sub MAIN (
    Int $digits #= Number of digits to calcuate
) {
    say calc-pi( $digits );
}
</code></pre>

<p>Simon was also reports in his blog post that he was prompted to use this formula by my question on <a href="https://www.nntp.perl.org/group/perl.perl6.users/2019/04/msg6664.html">perl6-users</a> and the answers provided by Fernando Santagata and Brian Duggan.</p>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-004/tim-smith/perl6/ch-1.p6">Tim Smith</a> used another so-called <a href="http://www.cs.ox.ac.uk/people/jeremy.gibbons/publications/spigot.pdf">spigot algorithm</a> like so:</p>

<pre><code class="language-Perl6">#| http://www.cs.ox.ac.uk/people/jeremy.gibbons/publications/spigot.pdf
sub gibbons-spigot() {
    my ($q, $r, $t, $i) = 1, 180, 60, 2;
    gather loop {
        my $u = 3 * (3 * $i + 1) * (3 * $i + 2);
        my $y = floor(($q * (27 * $i - 12) + 5 * $r) / (5 * $t));

        take $y;

        ($q, $r, $t, $i) =
            10 * $q * $i * (2 * $i - 1),
            10 * $u * ($q * (5 * $i - 2) + $r - $y * $t),
            $t * $u,
            $i + 1;
    }
}
</code></pre>

<hr />

<hr />

<h2 id="see-also">SEE ALSO</h2>

<hr />

<hr />

<p>Four blog posts on the subject:</p>

<ul>
<li><p>Mark Senn: <a href="http://engineering.purdue.edu/~mark/pwc-004.pdf">http://engineering.purdue.edu/~mark/pwc-004.pdf</a>;</p></li>

<li><p>Arne Sommer: <a href="https://perl6.eu/piermutations.html">https://perl6.eu/piermutations.html</a>;</p></li>

<li><p>Simon Proctor: <a href="https://www.khanate.co.uk/blog/2019/04/21/perl-weekly-week-4/">https://www.khanate.co.uk/blog/2019/04/21/perl-weekly-week-4/</a>;</p></li>

<li><p>Jo Christian Oterhals: <a href="https://medium.com/@jcoterhals/perl-6-small-stuff-17-a-weekly-challenge-of-big-pis-bags-and-modules-6c6c0867cb0a">https://medium.com/@jcoterhals/perl-6-small-stuff-17-a-weekly-challenge-of-big-pis-bags-and-modules-6c6c0867cb0a</a>.</p></li>
</ul>

<h2 id="wrapping-up">Wrapping up</h2>

<p>Please let me know if I forgot any of the challengers or if you think my explanation of your code misses something important (send me an e-mail or just raise an issue against this GitHub page).</p>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">SO WHAT DO YOU THINK ?</h1>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">If you have any suggestions or ideas then please do share with us.</p>
                    <a href="/contact" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Contact with me</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->


<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        <script>document.write(new Date().getFullYear())</script>
                    </span> PerlWeeklyChallenge. Theme Design and Developed by
                    <a href="http://www.Themefisher.com" target="_blank">Themefisher</a>.
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    <li>
                        <a href="https://twitter.com/PerlWChallenge" class="twitter" target="_blank" title="Follow us">
                            <i class="ion-social-twitter"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/rss.xml" class="rss" target="_blank" title="RSS Feed">
                            <i class="ion-social-rss"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.nomtimes.co.uk/site/shop.do?cref=PerlBooks" title="Free Perl Books" target="_blank">
                            <img src="/images/NomTimes.jpg" style="width:22px; height: 18px;" alt=""/>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://perlweeklychallenge.org/plugins/jQurey/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.form.js"></script>
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://perlweeklychallenge.org/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- chart js -->
<script src="https://perlweeklychallenge.org/plugins/chart/highstock.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/drilldown.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/data.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/chart.js"></script>
<!-- wow js -->
<script src="https://perlweeklychallenge.org/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://perlweeklychallenge.org/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://perlweeklychallenge.org/js/script.min.js"></script>
<!-- google analitycs -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-136524905-1', 'auto');
    ga('send', 'pageview');
</script>
</body>

</html>

