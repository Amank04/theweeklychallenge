<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
    <!-- Basic Page Needs -->
    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title"       content="Perl Weekly Challenge - Perl 5 & Perl 6"/>
    <meta property="og:type"        content="website"/>
    <meta property="og:url"         content="https://perlweeklychallenge.org/"/>
    <meta property="og:image"       content="https://perlweeklychallenge.org/images/about/about.jpg"/>
    <meta property="og:description" content="You do not have to be an expert."/>
    <meta name="twitter:card"       content="summary" />
    <meta name="twitter:image"      content="https://perlweeklychallenge.org/images/about/about.jpg"/>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="description" content="Laurent Rosenfeld Weekly Review: Challenge - #014.">
    <meta name="author" content="Perl Weekly Challenge Team">
    <meta name="generator" content="Hugo 0.55.0-DEV" />

    <!-- Mobile Specific Metas -->
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Laurent Rosenfeld Weekly Review: Challenge - 014</title>
    <link rel="icon" href="https://perlweeklychallenge.org/images/favicon.ico">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>

    <!-- Twitter Bootstrs CSS -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.css">
    <!-- Ionicons Fonts Css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/ionicons/ionicons.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/animate-css/animate.css">
    <!-- Hero area slider css-->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slider/slider.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slick/slick.css">
    <!-- Fancybox -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.css">
    <!-- hover -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/hover/hover-min.css">
    <!-- template main css file -->
    
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/style.min.css" integrity="" media="screen">
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/main.css">
</head>

<body>

<section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="https://perlweeklychallenge.org/">
                        <img src="https://perlweeklychallenge.org/images/logo.svg" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navgation" aria-controls="navigation"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/">Home</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/about">About</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/chart">Chart</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/champions">Champions</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/team">Team</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/challenges">Challenges</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p5-reviews">Perl/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p6-reviews">Raku/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/recaps">Recaps</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/blogs">Blogs</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/faq">FAQ</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/contact">Contact</a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>


<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Laurent Rosenfeld Weekly Review: Challenge - 014</h2>
                    <div class="portfolio-meta">
                        <span>Sunday, Oct 27, 2019</span>|
                        <span> Tags:
                            Raku
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div style="text-align: center" class="post-img">
                    <img class="img-fluid" alt="" src="https://perlweeklychallenge.org/images/blog/p6-review-challenge-014.jpg">
                </div>
                
                <div style="text-align: justify" class="post-content">
                    

<hr />

<h1 id="raku-solutions-weekly-review">Raku Solutions Weekly Review</h1>

<hr />

<h2 id="task-1-van-eck-s-sequence">Task #1: Van Eck&rsquo;s Sequence</h2>

<p>This is derived in part from my <a href="http://blogs.perl.org/users/laurent_r/2019/06/perl-weekly-challenge-14-van-ecks-sequence-and-us-states.html">blog post</a> made in answer to the <a href="https://perlweeklychallenge.org/blog/perl-weekly-challenge-014/">Week 14 of the Perl Weekly Challenge</a> organized by  <a href="http://blogs.perl.org/users/mohammad_s_anwar/">Mohammad S. Anwar</a> as well as answers made by others to the same challenge.</p>

<p>The challenge reads as follows:</p>

<p><em>Write a script to generate Van Eck’s sequence starts with 0. For more information, please check out <a href="https://en.wikipedia.org/wiki/Van_Eck%27s_sequence">wikipedia page</a>. This challenge was proposed by team member Andrezgz.</em></p>

<p>Jan Ritsema van Eck&rsquo;s sequence is an integer sequence defined recursively as follows. Let a(0) = 0. Then, for n ≥ 0, if there exists an m &lt; n such that a(m) = a(n), take the largest such m and set a(n+1) = n − m; otherwise a(n+1) = 0. Thus, the first occurrence of an integer in the sequence is followed by a 0, and the second and subsequent occurrences are followed by the size of the gap between the two most recent occurrences.</p>

<h2 id="my-solutions">My Solutions</h2>

<p>The definition is quite simple, but, for some reason (maybe the heatwave striking a good part of Western Europe at the time), it took me more time (about 30 minutes) than I expected to get it right. Anyway, here we go:</p>

<pre><code class="language-Perl6">use v6;

my @a = 0,;
for ^20 -&gt; $n {
    my $result = 0;
    for reverse ^$n -&gt; $m {
        $result = $n - $m and last if @a[$m] == @a[$n];
            # Note: $m is always smaller than $n, so $n - $m &gt; 0
    }
    push @a, $result;
}
say @a;
</code></pre>

<p>Not much to say about it: we just apply the definition, and the code is pretty small. This outputs the following sequence:</p>

<pre><code>$ perl6 vaneck.p6
[0 0 1 0 2 0 2 2 1 6 0 5 0 2 6 5 4 0 5 3 0]
</code></pre>

<p>Since we have nested loops, I have been thinking whether it might be possible to store the values in a hash or a set, or use a junction, to avoid performing the inner loop when possible.</p>

<p>But looking at a longer version of the sequence, for example:</p>

<pre><code>[0 0 1 0 2 0 2 2 1 6 0 5 0 2 6 5 4 0 5 3 0 3 2 9 0 4 9 3 6 14 0 6 3 5 15 0 5 3 5 2 17 0 6 11 0 3 8 0 3 3 1 42 0 5 15 20 0 4 32 0 3 11 18 0 4 7 0 3 7 3 2 31 0 6 31 3 6 3 2 8 33]
</code></pre>

<p>it appears that, except at the very beginning of the sequence, zeros are relatively rare, meaning that there are only few cases where we will go through the whole list and not find an <code>$m</code> within the inner loop. Therefore, there is probably no or little point trying to optimize away the inner loop by a lookup mechanism: we will not get a very significant performance improvement. (That&rsquo;s what I was thinking at the time I wrote the original blog post; thinking again about it several months later,  I think a hash lookup would probably be better, especially if you want to generate a long sequence;  several of the alternate solutions below implement this.)</p>

<p>Maybe a solution using the <code>gather/take</code> construct to produce lazy lists would be more idiomatic Perl 6 code. Let&rsquo;s see what we can do.</p>

<pre><code class="language-Perl6">use v6;

sub MAIN ( UInt $max ) {
    my @a = lazy gather {
        take 0;
        for 0..* -&gt; $n {
            my $result = 0;
            for reverse ^$n -&gt; $m {
                $result = $n - $m and last if @a[$m] == @a[$n];
            }
            take $result;
        }
    }
    say join &quot; &quot;, @a[0..$max];
}
</code></pre>

<p>It works and produces the same output as before, and using a lazy infinite list may look slightly more Perl-6-ish, but it does not make the code simpler, quite to the contrary. So, ultimately, I tend to prefer my first solution.</p>

<h2 id="alternative-solutions">Alternative Solutions</h2>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-014/arne-sommer/perl6/ch-1.p6">Arne Sommer</a> decided, contrary to me, to use a look-up hash. As already mentioned, it may be a better solution, after all.</p>

<pre><code class="language-Perl6">my @van-eck = (0);
my %seen;
for ^($limit -1) -&gt; $pos
{
  %seen{@van-eck[*-1]}.defined
   ?? @van-eck.push: $pos - %seen{@van-eck[*-1]}
   !! @van-eck.push: 0;

  %seen{@van-eck[*-2]} = $pos;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-014/athanasius/perl6/ch-1.p6">Athanasius</a> also went for a hash look-up:</p>

<pre><code class="language-Perl6">sub van-eck(Int:D $length --&gt; Array)
{
    my @seq = (Nil, 0);
    my %indices;

    for 1 .. $length - 1 -&gt; Int $n
    {
        my $old_term = @seq[$n];
        push @seq, %indices{$old_term}:exists ?? $n - %indices{$old_term} !! 0;
        %indices{$old_term} = $n;
    }

    shift  @seq;
    return @seq;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-014/fjwhittle/perl6/ch-1.p6">Francis J. Whittle</a> also used a hash look-up, but created an infinite sequence of Van Eck numbers:</p>

<pre><code class="language-Perl6">my \Van_Eck := gather {
  take $start;
  my %m = $start =&gt; 0;

  for ^∞ -&gt; $n {
    take %m{Van_Eck[$n]}:exists ?? $n - %m{Van_Eck[$n]} !! 0;
    %m{Van_Eck[$n]} = $n;
  }
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-014/joelle-maslak/perl6/ch-1.p6">Joelle Maslak</a> also used hash look-up:</p>

<pre><code class="language-Perl6">sub MAIN(UInt:D $length = 19) {
    my $seq = lazy gather { for 0..∞ -&gt; $n { take van-eck($n) } }
    say $seq[^$length].join(&quot; &quot;);
}
my %cache-by-val = 0 =&gt; [0, 1];
my @cache-by-pos = 0, 0;

multi sub van-eck(0 --&gt; UInt:D) { 0 }
multi sub van-eck(1 --&gt; UInt:D) { 0 }
multi sub van-eck(UInt:D $pos --&gt; UInt:D) {
    return @cache-by-pos[$pos] if @cache-by-pos[$pos]:exists;
    # Ensure cache is populated.
    for ^$pos -&gt; $p { van-eck($p) }
    my $n = $pos - 1;
    # We know that we must have been called in order.
    my $prev = van-eck($n);
    my $current;
    if %cache-by-val{$prev} and %cache-by-val{$prev}.elems ≥ 2 {
        my $m = %cache-by-val{$prev}[*-2];
        $current = $n - $m;
    } else {
        $current = 0;
    }
    @cache-by-pos[$pos] = $current;
    ( %cache-by-val{$current} //= Array.new ).push: $pos;

    return $current;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-014/feng-chang/perl6/ch-1.p6">Fench Chang</a> chose, like me, to traverse the current <code>@eck</code> array backward to find the previous matching value;</p>

<p>sub MAIN(UInt $n) {
    my @eck = 0, 0;
    for 2..$n -&gt; Int $i {
        @eck[$i] = 0;</p>

<pre><code>    for $i - 2 ... 0 -&gt; Int $j {
        if @eck[$j] == @eck[$i - 1] {
            @eck[$i] = $i - $j - 1;
            last;
        }
    }
}
say @eck;
</code></pre>

<p>}</p>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-014/jaldhar-h-vyas/perl6/ch-1.p6">Jaldhar H. Vyas</a> wrote the <code>backtrack</code> subroutine to traverse the current  <code>@vanEcks</code> array backward:</p>

<pre><code class="language-Perl6">sub backtrack($n, @vanEcks) {
    loop (my $i = @vanEcks.elems - 1; $i &gt; 0; $i--) {
        if @vanEcks[$i - 1] == $n {
            return @vanEcks.elems - $i;
        }
    }
    return 0;
}
multi sub MAIN() {
    my @vanEcks = (0);
    my $n = 0;
    while @vanEcks.elems &lt;= 100 {
        @vanEcks.push($n);
        $n = backtrack($n, @vanEcks);
    }
    @vanEcks.join(&quot;, &quot;).say;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-014/ruben-westerberg/perl6/ch-1.p6">Ruben Westerberg</a> also chose to traverse the current Van Eck sequence to find the previous matching value:</p>

<pre><code class="language-Perl6">my @a=(0);
for 0..^$nn -&gt; $n {
    my $max= @a[0..^$n].grep(@a[$n],:k).max();
    @a[$n+1]=$max == -Inf??0!!$n-$max;
}
</code></pre>

<h2 id="see-also">SEE ALSO</h2>

<p>Four blog posts on the subject this time:</p>

<ul>
<li><p>Arne Sommer: <a href="https://perl6.eu/van-eck-state.html">https://perl6.eu/van-eck-state.html</a>;</p></li>

<li><p>Athanasius: <a href="http://blogs.perl.org/users/athanasius/2019/06/perl-weekly-challenge-014.html">http://blogs.perl.org/users/athanasius/2019/06/perl-weekly-challenge-014.html</a>;</p></li>

<li><p>Francis J. Whittle: <a href="https://rage.powered.ninja/2019/06/30/hashed-up-sequencing.html">https://rage.powered.ninja/2019/06/30/hashed-up-sequencing.html</a>;</p></li>

<li><p>Jaldhar H. Vyas: <a href="https://www.braincells.com/perl/2019/06/perl_weekly_challenge_week_14.html">https://www.braincells.com/perl/2019/06/perl_weekly_challenge_week_14.html</a>.</p></li>
</ul>

<h2 id="wrapping-up">Wrapping up</h2>

<p>Please let me know if I forgot any of the challengers or if you think my explanation of your code misses something important (send me an e-mail or just raise an issue against this GitHub page).</p>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">SO WHAT DO YOU THINK ?</h1>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">If you have any suggestions or ideas then please do share with us.</p>
                    <a href="/contact" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Contact with me</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->


<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        <script>document.write(new Date().getFullYear())</script>
                    </span> PerlWeeklyChallenge. Theme Design and Developed by
                    <a href="http://www.Themefisher.com" target="_blank">Themefisher</a>.
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    <li>
                        <a href="https://twitter.com/PerlWChallenge" class="twitter" target="_blank" title="Follow us">
                            <i class="ion-social-twitter"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/rss.xml" class="rss" target="_blank" title="RSS Feed">
                            <i class="ion-social-rss"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.nomtimes.co.uk/site/shop.do?cref=PerlBooks" title="Free Perl Books" target="_blank">
                            <img src="/images/NomTimes.jpg" style="width:22px; height: 18px;" alt=""/>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://perlweeklychallenge.org/plugins/jQurey/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.form.js"></script>
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://perlweeklychallenge.org/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- chart js -->
<script src="https://perlweeklychallenge.org/plugins/chart/highstock.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/drilldown.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/data.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/chart.js"></script>
<!-- wow js -->
<script src="https://perlweeklychallenge.org/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://perlweeklychallenge.org/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://perlweeklychallenge.org/js/script.min.js"></script>
<!-- google analitycs -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-136524905-1', 'auto');
    ga('send', 'pageview');
</script>
</body>

</html>

