<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
    <!-- Basic Page Needs -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title"       content="The Weekly Challenge - Perl & Raku"/>
    <meta property="og:type"        content="website"/>
    <meta property="og:url"         content="https://perlweeklychallenge.org/"/>
    <meta property="og:image"       content="https://perlweeklychallenge.org/images/about/about.jpg"/>
    <meta property="og:description" content="You do not have to be an expert."/>
    <meta name="twitter:card"       content="summary" />
    <meta name="twitter:image"      content="https://perlweeklychallenge.org/images/about/about.jpg"/>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="description" content="Laurent Rosenfeld Weekly Review: Challenge - #037.">
    <meta name="author" content="Perl Weekly Challenge Team">
    <meta name="generator" content="Hugo 0.55.0-DEV" />

    <!-- Mobile Specific Metas -->
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Laurent Rosenfeld Weekly Review: Challenge - 037</title>
    <link rel="icon" href="https://perlweeklychallenge.org/images/favicon.ico">

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>

    <!-- Twitter Bootstrs CSS -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.css">
    <!-- Ionicons Fonts Css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/ionicons/ionicons.min.css">
    <!-- animate css -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/animate-css/animate.css">
    <!-- Hero area slider css-->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slider/slider.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/slick/slick.css">
    <!-- Fancybox -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.css">
    <!-- hover -->
    <link rel="stylesheet" href="https://perlweeklychallenge.org/plugins/hover/hover-min.css">
    <!-- template main css file -->
    
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/style.min.css" integrity="" media="screen">
    <link rel="stylesheet" href="https://perlweeklychallenge.org/css/main.css">
</head>

<body>

<section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="https://perlweeklychallenge.org/">
                        <img src="https://perlweeklychallenge.org/images/logo.svg" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navgation" aria-controls="navigation"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/">Home</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/about">About</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/chart">Chart</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/champions">Champions</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/team">Team</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/challenges">Challenges</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p5-reviews">Perl/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/p6-reviews">Raku/Review</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/recaps">Recaps</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/blogs">Blogs</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/faq">FAQ</a>
                            </li>
                            
                            <li class="nav-item">
                                <a class="nav-link" href="https://perlweeklychallenge.org/contact">Contact</a>
                            </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>


<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>Laurent Rosenfeld Weekly Review: Challenge - 037</h2>
                    <div class="portfolio-meta">
                        <span>Sunday, Dec 22, 2019</span>|
                        <span> Tags:
                            Raku
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div style="text-align: center" class="post-img">
                    <img class="img-fluid" alt="" src="https://perlweeklychallenge.org/images/blog/p6-review-challenge-037.jpg">
                </div>
                
                <div style="text-align: justify" class="post-content">
                    

<hr />

<h1 id="raku-solutions-weekly-review">Raku Solutions Weekly Review</h1>

<hr />

<h2 id="task-1-daylight-loss-or-gain">Task #1: Daylight Loss or Gain</h2>

<p>This is derived in part from my <a href="http://blogs.perl.org/users/laurent_r/2019/12/perl-weekly-challenge-37-week-days-in-each-month-and-daylight-gainloss.html">blog post</a> made in answer to the <a href="https://perlweeklychallenge.org/blog/perl-weekly-challenge-037/">Week 37 of the Perl Weekly Challenge</a> organized by  <a href="http://blogs.perl.org/users/mohammad_s_anwar/">Mohammad S. Anwar</a> as well as answers made by others to the same challenge.</p>

<p>The challenge reads as follows:</p>

<p><em>Write a script to find out the Daylight gain/loss in the month of December 2019 as compared to November 2019 in the city of London. You can find out sunrise and sunset data for <a href="https://www.timeanddate.com/sun/uk/london?month=11&amp;year=2019">November 2019</a> and <a href="https://www.timeanddate.com/sun/uk/london?month=12&amp;year=2019">December 2019</a> for London.</em></p>

<p>A look at the links provided reveals that the linked pages provide not only sunrise and sunset data, but also daylight duration, which is really the input data we&rsquo;re looking for. Not only is it going to be slightly easier to use directly daylight duration, but daylight values are also sixty times more accurate: sunrise and sunset have an accuracy of a minute, whereas daylight duration are precise to the second (so that, in fact, it won&rsquo;t really be easier, since our calculations will need to be more accurate (and that&rsquo;s a bit of a pain in the neck when values are given in sexagesimal or base-60 notation).</p>

<p>Otherwise, the requirement is not very clear, but I&rsquo;ll take it to mean that we want to compute the daylight gain or loss between each day of December 2019 and the corresponding day in November 2019. Since November has only 30 days, we won&rsquo;t be able to say anything about December 31, 2019, as there is no corresponding day in November. We will also compute the average daylight gain or loss (well, it&rsquo;s obviously a loss, but we&rsquo;ll assume we don&rsquo;t know and will let the computer program find this out).</p>

<h2 id="my-solutions">My solutions</h2>

<p>For the sake of this task, we just copied and pasted the data into two separate text files (one for November and one for December) and edited them to remove useless data and fix the format; and we then use those text files as input for my programs. The text file for November 2019 looks as follows:</p>

<pre><code>1   06h53   16h34   9:40:44
2   06h55   16h32   9:37:10
3   06h56   16h30   9:33:37
4   06h58   16h28   9:30:07
5   07h00   16h27   9:26:38
[ ... Lines omitted for brevity ...]
28  07h38   15h57   8:18:24
29  07h40   15h56   8:16:09
30  07h41   15h55   8:13:59
</code></pre>

<p>The December file has the same format. Even though the text file includes sunrise and sunset times, we&rsquo;ll use only the last column (day light duration) of these files, as it is more accurate.</p>

<p>In order to compute differences between values in sexagesimal notation (in base 60, i.e. expressed in hours/minutes/seconds), we will convert everything to seconds, perform arithmetic operations on values in seconds, and convert the result back into HMS sexagesimal values if needed. The <code>sec2hrs</code> and <code>hrs2sec</code> subroutines perform the necessary conversions from and to seconds.</p>

<p>The program first reads through the input data and stores the daylight data into an <code>@nov</code>and an <code>@dec</code> arrays. Then it loops through the <code>1..30</code> range and, for each day, subtract the November daylight value from the December daylight value. The program also computes an average change over 30 days.</p>

<p>The <code>sec2hrs</code> subroutine is much simpler than what I had to do for solving the same task in Perl 5 because it uses the multiple modulo <a href="https://docs.raku.org/routine/polymod">polymod</a> method to convert directly seconds into hours, minutes and seconds. Also, we used the <code>Z-</code> <a href="https://docs.raku.org/language/operators#index-entry-Z_(zip_metaoperator)">zip</a> metaoperator along with the <code>-</code> subtract operator to compute all the duration differences in just one single statement.</p>

<pre><code class="language-Perl">use v6;
sub hrs2sec ($hms) {
    my ($hrs, $min, $sec) = split /\:/, $hms;
    return $hrs * 60² + $min * 60 + $sec;
}
sub sec2hrs (Numeric $sec) {
    my @duration = $sec.abs.polymod(60, 60);
    my $fmt = ($sec &lt; 0 ?? &quot;-&quot; !! &quot;&quot;) ~ &quot;%d:%02d:%02d&quot;;
    return sprintf $fmt, @duration[2, 1, 0];
}
my @nov = 'november_2019.txt'.IO.lines[0..29].map({(.split(/\s+/))[3]});
my @dec = 'december_2019.txt'.IO.lines[0..29].map({(.split(/\s+/))[3]});
my @diff = @dec.map({hrs2sec $_}) Z- @nov.map({hrs2sec $_});
say &quot;Daylight changes between Dec and Nov:&quot;;
for @diff.kv -&gt; $k, $v { printf &quot;%2d: %s\n&quot;, $k + 1, sec2hrs( $v) };
say &quot;\nAverage change between Nov and Dec: &quot;, sec2hrs ([+] @diff) / 30;
</code></pre>

<p>This program displays the following output:</p>

<pre><code>$ perl6  day_light.p6
Daylight changes between Dec and Nov:
 1: -1:28:51
 2: -1:27:17
 3: -1:25:40
 4: -1:24:00
 5: -1:22:16
 6: -1:20:29
 7: -1:18:37
 8: -1:16:42
 9: -1:14:44
10: -1:12:42
11: -1:10:35
12: -1:08:26
13: -1:06:13
14: -1:03:56
15: -1:01:37
16: -0:59:13
17: -0:56:45
18: -0:54:15
19: -0:51:42
20: -0:49:05
21: -0:46:25
22: -0:43:42
23: -0:40:57
24: -0:38:09
25: -0:35:17
26: -0:32:24
27: -0:29:29
28: -0:26:31
29: -0:23:32
30: -0:20:32

Average change between Nov and Dec: -0:58:20
</code></pre>

<h2 id="alternative-solutions">Alternative Solutions</h2>

<p>I said at the beginning that I found the requirement not to be very clear. This is confirmed by the fact that the challengers interpreted the task in at least three different ways.</p>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/arne-sommer/perl6/ch-2.p6">Arne Sommer</a> used the <code>LWP::Simple</code> module to retrieve the data directly from the Web page, but also cached the pages locally to avoid waste of time and resources. His program also converts durations in HMS into seconds to perform the calculations and back to HMS when needed (see the <code>hms2s</code>and <code>s2hms</code> subroutine below). This is the part of Arne&rsquo;s code for comparing the monthly data:</p>

<pre><code class="language-Perl">for 1..31 -&gt; $day
{
  my $left-value  = %data{$left}{$day};
  my $right-value = %data{$right}{$day};
  ! $left-value &amp;&amp; ! $right-value &amp;&amp; last;
  print $day.fmt('%2d') ~ ' ';
  print $left-value
    ?? $left-value.fmt('%9s') ~ '  '
    !! ' ' x 11;
   print $right-value
   ?? $right-value.fmt('%9s') ~ '  '
   !! ' ' x 11;
  print &quot;{ (s2hms( hms2s($right-value) - hms2s($left-value))).fmt('%10s') }&quot; if $left-value &amp;&amp; $right-value;
  say '';
}
sub hms2s ($hms)
{
  my @parts = $hms.split(':') // return 0;
  return @parts[0] * 60 * 60 + @parts[1] * 60 + @parts[2];
}
sub s2hms ($s is copy)
{
  my $sign = &quot;&quot;;
  if $s &lt; 0 { $s = -$s; $sign = &quot;-&quot;; }
  my $h = $s div 3600; $s -=  $h * 3600;
  my $m = $s div   60; $s -=  $m *   60;
  return &quot;$sign$h:{ $m.fmt('%02d') }:{ $s.fmt('%02d') }&quot; if $h;
  return &quot;$sign$m:{ $s.fmt('%02d') }&quot; if $s;
  return &quot;$sign$s&quot;;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/kevin-colyer/perl6/ch-2.p6">Kevin Colyer</a> used the day-length difference data from the web pages and obviously did not understand the task in the same way as me and Arne: if I understand correctly, he computed the daylight gain or loss in the course of November (i.e. between Nov. 1 and Nov. 30) and likewise in December. This is his code doing the computations from the daily day-length difference column of the Web pages:</p>

<pre><code class="language-Perl">sub parse-duration($s) {
    my $sign=$s.substr(0,1);
    my @min-secs = $s.substr(1..*).split(&quot;:&quot;); # assumes no hours... not robust!
    return ( @min-secs[0] * 60 + @min-secs[1] ) * ( $sign eq &quot;-&quot; ?? -1 !! 1 );
}

sub say-duration($d) {
    my $sign = $d &lt; 0 ?? &quot;-&quot; !! &quot;&quot;;
    # concats '-' if negative, then forces positive value, modular divides by 60 twice, reverses the list then sends each item to be formatted for printing and joins them with ':'. Phew!
    return $sign ~ $d.abs.polymod(60, 60).reverse&gt;&gt;.fmt(&quot;%02d&quot;).join(&quot;:&quot;);
}

say &quot;Nov (gain/loss) hh:mm:ss &quot; ~ say-duration [+] ( parse-duration $_ for %n.values ) ;
say &quot;Dec (gain/loss) hh:mm:ss &quot; ~ say-duration [+] ( parse-duration $_ for %d.values ) ;
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/rnuttall/perl6/ch-2.p6">Richard Nuttall</a>, who is new to the challenge if I am not wrong, apparently also understood that the task was to compute the daylight loss in November and the daylight loss in December. He used the <code>LWP::Simple</code> and <code>HTML::Parser::XML</code> modules to fetch and parse the Web page data. This is his code to parse the input data and perform the relevant calculations:</p>

<pre><code class="language-Perl">sub GetDaytime($url,$fn --&gt; Int:D) {
    my $parser  = HTML::Parser::XML.new;
    my $xmldoc  = $parser.parse(GetPage($url,$fn));
    my $daytime = 0;

    my $table = $xmldoc.root.elements(:TAG&lt;table&gt;, :RECURSE)[0]; # There is only one table
    for $table.elements(:TAG&lt;tr&gt;, :RECURSE) -&gt; $tr {
        my $td = $tr.elements(:TAG&lt;td&gt;, :RECURSE);
        next unless $td.elems == 12;                             # Ignore header row
        my $daylen = $td[2].nodes[0].text;                       # Daylength is in 3rd column ...
        $td[2].nodes[0].text ~~ /(\d+) ':' (\d+) ':' (\d+)/;     # ... as HH:MM:SS
        $daytime += $0*60*60 + $1*60 + $2;
    }
    return $daytime;
}
sub MAIN($year = 2019) {
    my $daytimeDec = GetDaytime('https://www.timeanddate.com/sun/uk/london?month=12&amp;year=2019','London-2019-12');
    my $daytimeNov = GetDaytime('https://www.timeanddate.com/sun/uk/london?month=11&amp;year=2019','London-2019-11');

    say &quot;December $year has a total of $daytimeDec seconds daylength in London&quot;;
    say &quot;November $year has a total of $daytimeNov seconds daylength in London&quot;;
    my $diff = $daytimeNov - $daytimeDec;
    say &quot;November is longer by $diff seconds, or &quot;, ($diff.polymod(60, 60, 24, 7) Z &lt;sec min hr d wk&gt;).grep(*[0]).reverse.join(&quot;, &quot;);
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/ulrich-rieke/perl6/ch-2.p6">Ulrich Rieke</a> apparently also understood that the task was to compute the daylight loss in November and the daylight loss in December. He created <code>DateTime</code> objects for sunrise and sunset on the first and last day of each month, for example:</p>

<pre><code class="language-Perl">my $novemberstart_sunrise = DateTime.new( year =&gt; 2019 ,
                                          month =&gt; 11 ,
                      day =&gt; 1 ,
                      hour =&gt; 6 ,
                      minute =&gt; 53 ,
                      second =&gt; 0 ,
                      timezone =&gt; 1 ) ;
</code></pre>

<p>and then simply used subtraction between <code>DateTime</code> objects to find the November and the December loss:</p>

<pre><code class="language-Perl">my $daylength1 = $novemberstart_sunset - $novemberstart_sunrise ;
my $daylength2 = $novemberend_sunset - $novemberend_sunrise ;
my $novemberloss = $daylength1 - $daylength2 ;
say &quot;Loss of daylength in november : &quot; ~ $novemberloss.Str ~ &quot; seconds!&quot; ;
$daylength1 = $decemberstart_sunset - $decemberstart_sunrise ;
$daylength2 = $decemberend_sunset - $decemberend_sunrise ;
my $decemberloss = $daylength1 - $daylength2 ;
say &quot;Loss of daylength in december : &quot; ~ $decemberloss.Str ~ &quot; seconds!&quot; ;
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/daniel-mita/perl6/ch-2.p6">Daniel Mita</a> apparently understood the challenge the same way as Kevin, Richard and Ulrich, but I&rsquo;m not entirely sure, since his program uses a JSON file as source data, and I&rsquo;m not quite sure where this JSON file is coming from and what it contains. Anyway, this is Daniel&rsquo;s code:</p>

<pre><code class="language-Perl6">my %data = 'sun-data.json'.IO.slurp.&amp;from-json.map(|*);
my Duration ( $nov, $dec );

for %data.keys -&gt; $k {
  my $d := Date.new($k);
  my &amp;adder := -&gt; $month is rw {
    $month += [-] %data{$k}&lt;sunset sunrise&gt;.map({ DateTime.new($_) })
  };

  given $d.month {
    when 11 {
      $nov.&amp;adder;
    }
    when 12 {
      $dec.&amp;adder;
    }
  }
}

say &quot;Daylight in November: $nov seconds&quot;;
say &quot;Daylight in December: $dec seconds&quot;;
say &quot;Difference: {($nov - $dec).abs} seconds&quot;;
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/javier-luque/perl6/ch-2.p6">Javier Luque</a> understood yet some other thing. If I understand his program well, it computes the cumulated daylight time in November and in December, and then computes the difference between the two months. The main part of Javier&rsquo;s program is as follows:</p>

<pre><code class="language-Perl6">sub compare_lengths(Date $date1, Date $date2) {
    # Months
    my @mon = (
        'Jan', 'Feb', 'Mar', 'Apr',
        'May', 'Jun', 'Jul', 'Aug',
        'Sep', 'Oct', 'Nov', 'Dec'
    );

    # Get the data from the web
    my @date1_data =
        get-data($date1);
    my @date2_data =
        get-data($date2);

    # Calculate totals
    my $date1_total = calculate-daylight-total(@date1_data);
    my $date2_total = calculate-daylight-total(@date2_data);
    my $difference = $date1_total - $date2_total;

    # Print the output
    say @mon[$date1.month - 1] ~ ' ' ~ $date1.year ~ ' has ' ~
        convert-seconds-to-string($date1_total) ~
        ' of daylight.';

    # Print the output
    say @mon[$date2.month - 1] ~ ' ' ~ $date2.year ~ ' has ' ~
        convert-seconds-to-string($date2_total) ~
        ' of daylight.';

    say &quot;The difference is: &quot; ~
        convert-seconds-to-string($difference) ~ '.';
}

# Calculates the total daylight hours from data
sub calculate-daylight-total(@data) {
    my $total = 0;
    for (@data) -&gt; $daylight {
        $total += convert-time-to-seconds($daylight).Int;
    }
    return $total
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/mark-anderson/perl6/ch-2.p6">Mark Anserson</a> used the <code>HTTP::UserAgent</code> and <code>DOM::Tiny</code>module to fetch and process the input data. His program is among the most concise ones:</p>

<pre><code class="language-Perl">use HTTP::UserAgent;
use DOM::Tiny;

my $dt = DateTime.new(secs(11) - secs(12));

say &quot;Dec has &quot; ~ ($dt.hour,$dt.minute,$dt.second).join(&quot;:&quot;) ~ &quot; less daylight&quot;;

sub secs($month) {
    my $link = &quot;https://www.timeanddate.com/sun/uk/london?month=$month&amp;year=2019&quot;;

    my $ua = HTTP::UserAgent.new;

    my $dom = DOM::Tiny.parse($ua.get($link).content);

    # load the 'Length' column values
    my $c = $dom.find('td[class=&quot;c tr sep-l&quot;]').map(*.text);

    # convert the hh::mm::ss to seconds and sum them
    $c.map({DateTime.new(&quot;1970-01-01T$_.subst(/^(\d):/, {0 ~ $0})&quot;).posix}).sum;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/roger-bell-west/perl6/ch-2.p6">Roger Bell West</a> used the <a href="https://github.com/Skarsnik/perl6-gumbo">Gombo</a> module, which is a binding to the C <a href="https://github.com/google/gumbo-parser">Gombo</a> library to parse HTML5 and which I had not heard about before. This module provides a <code>parse-html</code> routine that parses an input HTML string and returns a <code>XML::Document</code> object.</p>

<pre><code class="language-Perl">use Gumbo;

my @dtime;

for ('2019-11-london.html','2019-12-london.html') -&gt; $file {
  my $dlt=0;
  my $fh=open :r,$file;
  my $text='';
  for $fh.lines {
    $text ~= $_;
  }
  close $fh;
  my $xml=parse-html($text);
  my $tab=$xml.root.elements(:TAG&lt;table&gt;, :RECURSE)[0];
  for $tab.elements(:TAG&lt;tr&gt;, :RECURSE) -&gt; $tr {
    my @td=$tr.elements(:TAG&lt;td&gt;, :RECURSE);
    if (@td.elems==12) {
      my $dl=@td[2].nodes[0].text;
      $dl ~~ /(\d+) ':' (\d+) ':' (\d+)/;
      $dlt+=$0*3600+$1*60+$2;
    }
  }
  push @dtime,$dlt;
}
say 'delta ',@dtime[1]-@dtime[0],' s';
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/ruben-westerberg/perl6/ch-2.p6">Ruben Westerberg</a> used the <code>HTTP::UserAgent</code> module to fetch the two needed Web pages. Roger&rsquo;s interpretation of the task was apparently to compute the total day light duration in December with the total daylight duration in November (which is sort of unfair to November since it has one day less).</p>

<pre><code class="language-Perl">use HTTP::UserAgent;

print &quot;Downloading November Data...\n&quot;;
my $res=HTTP::UserAgent.new.get(&quot;https://www.timeanddate.com/sun/uk/london?month=11&amp;year=2019&quot;);
my $nov=$res.content;

print &quot;Downloading December Data...\n&quot;;
$res=HTTP::UserAgent.new.get(&quot;https://www.timeanddate.com/sun/uk/london?month=12&amp;year=2019&quot;);
my $dec= $res.content;

my $delta=extractDaylight($dec)- extractDaylight($nov);
my $sign= $delta&gt;=0??&quot;+&quot;!!&quot;-&quot;; $delta=abs($delta);
my $hours=($delta / 3600).Int; $delta-=$hours*3600;
my $mins=($delta/60).Int; $delta-=$mins*60;

print &quot;December gained $sign$hours:$mins:$delta (H:M:S) compared to November\n&quot;;

sub extractDaylight($text) {
    my $total =0;
    my @matches= $text~~ m:g/\&lt;td\sclass\=\&quot;c\str\ssep\-l\&quot;[.*?]\&gt;(.*?)\&lt;\/td\&gt;/;
    for @matches {
        my ($h,$m,$s)=split &quot;:&quot;,$_[0].Str;
        $total+=$h*3600+$m*60+$s;
    }
    $total;
}
</code></pre>

<h2 id="task-2-week-days-in-each-month">Task #2: Week Days in Each Month</h2>

<p>This is derived in part from my <a href="http://blogs.perl.org/users/laurent_r/2019/12/perl-weekly-challenge-37-week-days-in-each-month-and-daylight-gainloss.html">blog post</a> made in answer to the <a href="https://perlweeklychallenge.org/blog/perl-weekly-challenge-037/">Week 37 of the Perl Weekly Challenge</a> organized by  <a href="http://blogs.perl.org/users/mohammad_s_anwar/">Mohammad S. Anwar</a> as well as answers made by others to the same challenge.</p>

<p>The challenge reads as follows:</p>

<p><em>Write a script to calculate the total number of weekdays (Mon-Fri) in each month of the year 2019.</em></p>

<pre><code>Jan: 23 days
Feb: 20 days
Mar: 21 days
[... Lines omitted for brevity ...]
Nov: 21 days
Dec: 22 days
</code></pre>

<p>Although the challenge speaks only of year 2019, I&rsquo;ll expand it a bit to compute the total number of weekdays in each month of any year passed as a parameter (defaulted to 2019 if no year is passed).</p>

<h2 id="my-solutions-1">My solutions</h2>

<p>Raku (formerly known as Perl 6) has many expressive and efficient built-in features for date manipulations in the <a href="https://docs.raku.org/type/Date">Date</a> class.</p>

<p>This is an example under the REPL:</p>

<pre><code>&gt; my $date = Date.new(2019, 1, 1)
2019-01-01
&gt; say $date.month;
1
&gt; say $date.day-of-week;
2
</code></pre>

<p>So, Jan., 1st, 2019 fell on a Tuesday (day-in-week 2), and it is the first month (January).</p>

<p>Thus, using the <code>Date</code> methods demonstrated above, we could write simple a one-liner (formatted here over 2 lines to make more readable on this blog post) to find the result:</p>

<pre><code>$ perl6 -e 'my @a; for Date.new(2019, 1, 1) .. Date.new(2019, 12, 31) -&gt; $day
&gt; { @a[$day.month]++ if $day.day-of-week == (1..5).any}; say @a[1..12];
'
(23 20 21 22 23 20 23 22 21 23 21 22)
</code></pre>

<p>For every date in the year, we increment a counter for the date&rsquo;s month if that data is a weekday. Note the use of the <code>(1..5).any</code> junction to simplify comparisons with the <code>1..5</code> range.</p>

<p>We could even add a little bit of sugar to improve the output:</p>

<pre><code>$ perl6 -e 'my @a; for Date.new(2019, 1, 1) .. Date.new(2019, 12, 31) -&gt; $day
&gt; { @a[$day.month]++ if $day.day-of-week == (1..5).any};
&gt;  for @a[1..12].kv -&gt; $k, $v {printf &quot;%02d/2019: %d week days\n&quot;, $k+1, $v};
&gt; '
01/2019: 23 week days
02/2019: 20 week days
03/2019: 21 week days
04/2019: 22 week days
05/2019: 23 week days
06/2019: 20 week days
07/2019: 23 week days
08/2019: 22 week days
09/2019: 21 week days
10/2019: 23 week days
11/2019: 21 week days
12/2019: 22 week days
</code></pre>

<p>But that&rsquo;s perhaps getting a bit long for a one-liner. Let&rsquo;s do a real program. But, for the sake of  fun, we&rsquo;ll use a different method that doesn&rsquo;t need to iterate over every single day of the year.</p>

<p>If we have the number of days for each month of any year (including February), then it is fairly easy to compute the day in the week of any date in the year. We don&rsquo;t really need to do that for every single date because any month, including February, has four weeks, and thus 20 weekdays, between the 1st and the 28th day. Thus, we only need to figure out the day in week of days between the 29th day and the month end.</p>

<p>We will iterate only over the days after the 28th day of any month to find the number of weekdays in that interval, and the <code>Date</code> class has numerous numerous method to make this simple. The <code>Date</code> class also provides a <a href="https://docs.raku.org/type/Date#(Dateish)_method_days-in-month">days-in-month method</a> returning directly what we need: the number of days in a given month.</p>

<p>The program is very simple:</p>

<pre><code class="language-Perl6">use v6;

sub MAIN (UInt $yr = 2019) {
    for 1..12 -&gt; $mth {
        my $weekdays = 20;
        for 29..Date.new($yr, $mth, 1).days-in-month -&gt; $day {
            $weekdays++ if Date.new($yr, $mth, $day).day-of-week == (1..5).any;
        }
        printf &quot;%02d/%d has $weekdays week days.\n&quot;, $mth, $yr;
    }
}
</code></pre>

<p>This program displays the following output:</p>

<pre><code>$ perl6 weekdays.p6 2019
01/2019 has 23 week days.
02/2019 has 20 week days.
03/2019 has 21 week days.
04/2019 has 22 week days.
05/2019 has 23 week days.
06/2019 has 20 week days.
07/2019 has 23 week days.
08/2019 has 22 week days.
09/2019 has 21 week days.
10/2019 has 23 week days.
11/2019 has 21 week days.
12/2019 has 22 week days.
</code></pre>

<p>And it works fine with another year passed as an argument. If no argument is passed, the program correctly displays the result for the default input value, year 2019. Note that I didn&rsquo;t care about writing the month names in English, but it would be very simple to create an array with the month names in order to convert from month numbers to month names.</p>

<h2 id="alternative-solutions-1">Alternative Solutions</h2>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/arne-sommer/perl6/ch-1.p6">Arne Sommer</a> used the <code>day-of-week</code> and <code>later</code> methods of the <code>Date</code> class and iterated over all the days of the year, similarly to what I did in my one-liner solutions:</p>

<pre><code class="language-Perl6">unit sub MAIN (Int $year = 2019, Bool :$sum);

my @day-count;
my @month-name = (&quot;&quot;, &quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;);
my $date = Date.new($year, 1, 1);

while $date.year == $year
{
  @day-count[$date.month]++ if $date.day-of-week &lt;= 5;
  $date.=later(days =&gt; 1);
}
say &quot;Year: $year&quot; unless $year == 2019;
say &quot;@month-name[$_]: @day-count[$_] days&quot; for 1 .. 12;
say &quot;Total: { @day-count.sum}&quot; if $sum;
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/kevin-colyer/perl6/ch-1.p6">Kevin Colyer</a> did something similar using the <code>day-of-week</code> and <code>later</code> methods of the <code>DateTime</code> class to iterate over all days of the each month:</p>

<pre><code class="language-Perl6">my @month-abbrv=&lt;Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec&gt;;

sub weekdays-in-month(DateTime $date) {
    my $count=0;
    for ^$date.days-in-month -&gt; $day {
        $count++ unless $date.later(days =&gt; $day).day-of-week &gt;= 6;
    }
    return $count;
}

for 1..12 -&gt; $month {
    say sprintf &quot;%s: %02d days&quot;, @month-abbrv[$month-1],  weekdays-in-month(DateTime.new(year =&gt; 2019, month=&gt; $month, day =&gt; 1 ));
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/noud/perl6/ch-1.p6">Noud</a> also used the <code>day-of-week</code> and <code>later</code> methods of the <code>Date</code> class to iterate over all days of the year:</p>

<pre><code class="language-Perl6">my @a = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
for ^365 -&gt; $day {
    my $now = Date.new(2019, 1, 1).later(days =&gt; $day);
    if (0 &lt; $now.day-of-week &lt; 6) {
        @a[$now.month - 1]++;
    }
}

for &lt;Jan Feb Mar Apr May Jun
     Jul Aug Sep Oct Nov Dec&gt; Z @a -&gt; ($month, $work-days) {
    say &quot;$month: $work-days days&quot;;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/rnuttall/perl6/ch-1.p6">Richard Nuttall</a>, who is new to the challenge if I am not wrong, wrote a nice data pipeline computing for each month the number of days in the month in a single chained-methods statement. Note the interesting use of the <code>strftime</code> function of the <a href="https://github.com/supernovus/perl6-datetime-format/blob/master/lib/DateTime/Format.pm6">DateTime::Format</a> module to provide the month names.</p>

<pre><code class="language-Perl6">use v6;
use DateTime::Format;

sub MAIN(Int() $year = Date.today().year()) {
    for 1..12 -&gt; $month {
        my $d    = DateTime.new(year =&gt; $year, month =&gt; $month, day =&gt; 1);
        say strftime('%b', $d) ~ &quot;: &quot; ~
                map({Date.new(2019, $month, $_).day-of-week()},1 .. $d.days-in-month())
                .grep({$_ &lt;= 5})
                .elems;
    }
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/simon-proctor/perl6/ch-1.p6">Simon Proctor</a> also wrote a data pipeline of chained methods. Note the use of the <code>weekday-of-month</code> method of the <a href="https://docs.raku.org/type/Dateish#method_weekday-of-month">Dateish</a> role:</p>

<pre><code class="language-Perl">constant %MONTHS := Map.new( (1..12) Z &lt;Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec&gt; );

sub MAIN(
    Int() $year = Date.today().year() #= Year to display data for, defaults to this year
) {
    for (1..12) -&gt; $month {
        my $end = Date.new( :1day, :$month, :$year ).days-in-month();
        my $total = [+] (0..6).map( { Date.new( :day($end-$_), :$month, :$year ) } ).grep( { $_.day-of-week !~~ 6|7 } ).map( { $_.weekday-of-month } );
        say &quot;{%MONTHS{$month}} : {$total} days&quot;;
    }
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/ulrich-rieke/perl6/ch-1.p6">Ulrich Rielke</a> wrote two nested loops (over months and over days of the month) to iterate over all days of the year and used the <code>day-of-week</code> method of the <code>Date</code> class to populate a weekday counter for each month:</p>

<pre><code class="language-Perl">my %daycount = &quot;Jan&quot; =&gt; 31 , &quot;Feb&quot; =&gt; 28 , &quot;Mar&quot; =&gt; 31 , &quot;Apr&quot; =&gt; 30 ,
  &quot;May&quot; =&gt; 31 , &quot;Jun&quot; =&gt; 30 , &quot;Jul&quot; =&gt; 31 , &quot;Aug&quot; =&gt; 31 , &quot;Sep&quot; =&gt; 30 ,
  &quot;Oct&quot; =&gt; 31 , &quot;Nov&quot; =&gt; 30 , &quot;Dec&quot; =&gt; 31 ;
my @months = &lt;Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec&gt; ;
my %weekdaycount ;
my $weekdays ;
for (1..12) -&gt; $month {
  my $mon = @months[ $month - 1 ] ;
  for (1..%daycount{$mon}) -&gt; $day {
      my $date = Date.new( 2019 , $month , $day ) ;
      if ( 1 &lt;= $date.day-of-week &lt;= 5 ) {
    $weekdays++ ;
      }
  }
  %weekdaycount{ $mon } = $weekdays ;
  $weekdays = 0 ;
}
for @months -&gt; $month {
  say &quot;$month: {%weekdaycount{ $month }} days&quot; ;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/daniel-mita/perl6/ch-1.p6">Daniel Mita</a>&rsquo;s solution is quite innovative in several respects, and I must admit that I have some trouble understanding parts of his solution. I leave it to you to discover it:</p>

<pre><code class="language-Perl">enum Months «
  :Jan(1) Feb Mar
   Apr    May Jun
   Jul    Aug Sep
   Oct    Nov Dec
»;
&quot;$_.key(): $_.value()&quot;.say for (gather {
  given Date.new(:2019year) {
    take Months(.month) if .day-of-week ≠ 6|7;
    &amp;?BLOCK(.succ) if .succ.year == .year;
  }
}).Bag.pairs.sort({ ::{$^a.key} &lt;=&gt; ::{$^b.key} });
</code></pre>

<p>This is probably the first time that I see an enumeration used in Perl 6 (well at least in real code whose purpose is not to demonstrate enumerations).</p>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/javier-luque/perl6/ch-1.p6">Javier Luque</a> wrote a program that iterates over all day of the year and increments a counter in a hash of monthly counters each time a date corresponds to a week day:</p>

<pre><code class="language-Perl">sub show-weekdays-per-year(Int $year) {
    my $current = Date.new($year, 1, 1);
    my %months{Int};

    my @mon = (
        'Jan', 'Feb', 'Mar', 'Apr',
        'May', 'Jun', 'Jul', 'Aug',
        'Sep', 'Oct', 'Nov', 'Dec'
    );

    while ($current.year == $year) {
        %months{$current.month}++
            if ($current.day-of-week == (1 .. 5).any);
        $current++;
    }

    for %months.keys.sort -&gt; $key {
        say @mon[$key - 1] ~ ': ' ~
            %months{$key} ~ ' days';
    }
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/mark-anderson/perl6/ch-1.p6">Mark Anderson</a> used two nested <code>while</code> loops to iterate over each day of each month and the <code>day-of-week</code> method of the <code>Date</code> class to increment a counter for each weekday. Note the use of the <a href="https://github.com/tbrowder/Date-Names-Perl6">Date::Names</a> module to handle month names.</p>

<pre><code class="language-Perl">use Date::Names;

my $dt = DateTime.new(year =&gt; 2019, month =&gt; 1);
my $dn = Date::Names.new;

while ($dt.year == 2019) {
    my $count = 0;
    my $mon = $dn.mon($dt.month, 3);

    while ($dn.mon($dt.month, 3) eq $mon) {
        if ($dt.day-of-week &lt; 6) {
            $count++;
        }

        $dt = $dt.later(:day1);
    }

    say &quot;$mon:$count days&quot;;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/roger-bell-west/perl6/ch-1.p6">Roger Bell West</a> made a program based on the same observation as I did for my last solution: any month had 20 weekdays in its first 28 days, and it is therefore sufficient to count the weekdays after the 28th of each month, using the <code>day-of-week</code> method (starting the counter at 20). This being said, his detailed implementation is quite different from mine and works its way backward from the last day of the month using the <code>earlier</code> method:</p>

<pre><code class="language-Perl">my $y=2019;
for (1..12) -&gt; $m {
  my $mm=$m+1;
  my $yy=$y;
  if ($mm&gt;12) {
    $mm-=12;
    $yy++;
  }
  my $d=Date.new($yy,$mm,1).earlier(:1day);
  my $wd=20;
  while ($d.day&gt;28) {
    if ($d.day-of-week &lt; 6) {
      $wd++;
    }
    $d=$d.earlier(:1day);
  }
  say &quot;$m: $wd days&quot;;
}
</code></pre>

<p><a href="https://github.com/manwar/perlweeklychallenge-club/blob/master/challenge-037/ruben-westerberg/perl6/ch-1.p6">Ruben Westerberg</a> made one of shortest implementations among the challengers, despite the fact that his use of the <code>DateTime</code> class made it slightly more complicated than it would have been using the <code>Date</code> class.</p>

<pre><code class="language-Perl">my $t=DateTime.new(:2019year);
my %months;
my @names= &lt;January February March April May June July August September October November December&gt;;
while $t.year == 2019 {
    $t+=Duration.new(60*60*24);;
    %months{@names[$t.month-1]}++ if $t.day-of-week == any (1..5);
}
for  @names {
    put &quot;$_: %months{$_} week days&quot;
}
</code></pre>

<hr />

<h2 id="see-also">SEE ALSO</h2>

<hr />

<p>Only two blog posts (besides mine) this time:</p>

<ul>
<li><p>Arne Sommer: <a href="https://raku-musings.com/weekdays-daylight.html">https://raku-musings.com/weekdays-daylight.html</a>;</p></li>

<li><p>Javier Luque: <a href="https://perlchallenges.wordpress.com/2019/12/02/perl-weekly-challenge-037/">https://perlchallenges.wordpress.com/2019/12/02/perl-weekly-challenge-037/</a>.</p></li>
</ul>

<h2 id="wrapping-up">Wrapping up</h2>

<p>Please let me know if I forgot any of the challengers or if you think my explanation of your code misses something important (send me an e-mail or just raise an issue against this GitHub page).</p>

<p>If you want to participate to the Perl Weekly Challenge, please connect to <a href="https://perlweeklychallenge.org/">this site</a>.</p>

                </div>
            </div>
        </div>
    </div>
</section>


<!-- Call To Action Section Start -->
<section id="call-to-action">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2 class="title wow fadeInDown" data-wow-delay=".3s" data-wow-duration="500ms">SO WHAT DO YOU THINK ?</h2>
                    <p class="wow fadeInDown" data-wow-delay=".5s" data-wow-duration="500ms">If you have any suggestions or ideas then please do share with us.</p>
                    <a href="/contact" class="btn btn-default btn-contact wow fadeInDown" data-wow-delay=".7s" data-wow-duration="500ms">Contact with me</a>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Call To Action Section End -->



<!-- Footer Section Start -->
<footer id="footer">
    <div class="container">
        <div class="row content-justify-between">
            <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
                <p class="copyright">Copyright:
                    <span>
                        <script>document.write(new Date().getFullYear())</script>
                    </span> PerlWeeklyChallenge. Theme Design and Developed by
                    <a href="http://www.Themefisher.com" target="_blank">Themefisher</a>.
                </p>
            </div>
            <div class="col-md-4 col-12">
                <!-- Social Media -->
                <ul class="social text-center text-md-right text-lg-right">
                    <li>
                        <a href="https://twitter.com/PerlWChallenge" class="twitter" target="_blank" title="Follow us">
                            <i class="ion-social-twitter"></i>
                        </a>
                    </li>
                    <li>
                        <a href="/rss.xml" class="rss" target="_blank" title="RSS Feed">
                            <i class="ion-social-rss"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.nomtimes.co.uk/site/shop.do?cref=PerlBooks" title="Free Perl Books" target="_blank">
                            <img src="/images/NomTimes.jpg" style="width:22px; height: 18px;" alt=""/>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://perlweeklychallenge.org/plugins/jQurey/jquery.min.js"></script>
<!-- Form Validation -->
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.form.js"></script>
<script src="https://perlweeklychallenge.org/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="https://perlweeklychallenge.org/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://perlweeklychallenge.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- chart js -->
<script src="https://perlweeklychallenge.org/plugins/chart/highstock.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/drilldown.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/data.js"></script>
<script src="https://perlweeklychallenge.org/plugins/chart/chart.js"></script>
<!-- wow js -->
<script src="https://perlweeklychallenge.org/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://perlweeklychallenge.org/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://perlweeklychallenge.org/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://perlweeklychallenge.org/js/script.min.js"></script>
<!-- google analitycs -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-136524905-1', 'auto');
    ga('send', 'pageview');
</script>
</body>

</html>

